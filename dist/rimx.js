!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("immutable"),require("rxjs/add/operator/finally"),require("rxjs/add/operator/map"),require("rxjs/add/operator/distinctUntilChanged"),require("rxjs/add/operator/pluck"),require("rxjs/add/operator/takeUntil"),require("rxjs/BehaviorSubject"),require("rxjs/Subject"),require("react")):"function"==typeof define&&define.amd?define(["immutable","rxjs/add/operator/finally","rxjs/add/operator/map","rxjs/add/operator/distinctUntilChanged","rxjs/add/operator/pluck","rxjs/add/operator/takeUntil","rxjs/BehaviorSubject","rxjs/Subject","react"],t):"object"==typeof exports?exports.RimX=t(require("immutable"),require("rxjs/add/operator/finally"),require("rxjs/add/operator/map"),require("rxjs/add/operator/distinctUntilChanged"),require("rxjs/add/operator/pluck"),require("rxjs/add/operator/takeUntil"),require("rxjs/BehaviorSubject"),require("rxjs/Subject"),require("react")):e.RimX=t(e[void 0],e["rxjs/add/operator/finally"],e["rxjs/add/operator/map"],e["rxjs/add/operator/distinctUntilChanged"],e["rxjs/add/operator/pluck"],e["rxjs/add/operator/takeUntil"],e["rxjs/BehaviorSubject"],e["rxjs/Subject"],e[void 0])}(window,function(e,t,r,n,o,i,s,u,c){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=13)}([function(t,r){t.exports=e},function(e,t,r){var n,o,i;o=[t,r(0)],void 0===(i="function"==typeof(n=function(e,t){"use strict";function r(e){return"string"==typeof e||"number"==typeof e||void 0===e||null===e}Object.defineProperty(e,"__esModule",{value:!0}),e.compareFn=function(e,n){return r(e)&&r(n)?e===n:(0,t.is)(e,n)}})?n.apply(t,o):n)||(e.exports=i)},function(e,t,r){var n,o,i;o=[t,r(1)],void 0===(i="function"==typeof(n=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t,r,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.path=t,this.pluckPath=t.split("."),this.root=n,this.scopeId=r,this.streamControl=new Subject,this.closed=!1,this.stateObservable=n.store.asObservable().map(function(e){return e.getIn(o.pluckPath)})}return r(e,[{key:"subscribe",value:function(e,r,n){var o=this,i=this.root,s=this.stateObservable;s=r?s.map(function(e){return e.getIn(r)}).distinctUntilChanged(t.compareFn):s.distinctUntilChanged(t.compareFn),n&&(s=n(s));var u=s.subscribe(e),c=i.findScopeObservers(this.scopeId);if(!c)throw new Error("Unknow error");c.observers.push(u),i.observers.set(i.observers.findIndex(function(e){if(!e)throw new Error("cannot find the observer list of scope "+o.scopeId);return e.$scopeId===o.scopeId}),c);var a=u.unsubscribe;return u.unsubscribe=function(){a.call(u)},u}},{key:"next",value:function(e){if(!this.closed){var t=void 0,r=this.root;if("function"==typeof e){var n=r._getSnapshot(this.pluckPath);t=e(n)}else t=e;r.updateScope(this.path,t)}}},{key:"snapshot",value:function(){return this.root._getSnapshot(this.pluckPath)}},{key:"destroy",value:function(){var e=this,t=this.root,r=t.findScopeObservers(this.scopeId);this.closed=!0,r&&r.observers.forEach(function(e){return e.unsubscribe()}),t.deleteScope(this.path);var n=t.observers.findIndex(function(t){if(!t)throw new Error("cannot find the observer list of scope "+e.scopeId);return t.$scopeId===e.scopeId});t.observers=t.observers.delete(n)}}]),e}();e.default=n})?n.apply(t,o):n)||(e.exports=i)},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=s},function(e,t){e.exports=u},function(e,t,r){var n,o,i;o=[t,r(9),r(8),r(0),r(2),r(6),r(5),r(4),r(3),r(7)],void 0===(i="function"==typeof(n=function(e,t,r,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RxStoreFactory=void 0;var i=u(n),s=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();e.RxStoreFactory=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=new r.BehaviorSubject(i.default.Map()),this.scopeId=1,this.observers=i.default.List([])}return c(e,[{key:"injectScope",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1],r=this.initScope(t);this.updateScope(e,r)}},{key:"updateScope",value:function(e,t){var r=this,n=void 0,o=this.store.subscribe({next:function(o){n=r._processInject(e.split("."),o,t)},error:function(e){throw new Error(e)}});o.unsubscribe(),this.store.next(n)}},{key:"takeSnapshot",value:function(){var e=this,t=this.store.subscribe(function(t){console.group("RxStore snapshot"),console.log("root state: ",t.toJS()),console.log("subscriptions("+e.observers.size+"): ",e.observers.toJS()),console.log("subject observers("+e.store.observers.length+"): ",e.store.observers),console.groupEnd()});t.unsubscribe()}},{key:"deleteScope",value:function(e){var t=void 0,r=this.store.subscribe({next:function(r){t=r.deleteIn(e.split("."))},error:function(e){throw new Error(e)}});r.unsubscribe(),this.store.next(t)}},{key:"_processInject",value:function(e,t,r){return t.mergeIn(e,r)}},{key:"initScope",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.scopeId++;return this.observers=this.observers.push({$scopeId:t,observers:[]}),Object.assign(e,{$scopeId:t})}},{key:"findScopeObservers",value:function(e){var t=this;return this.observers.find(function(r){if(!r)throw new Error("cannot find the observer list of scope "+t.scopeId);return r.$scopeId===e})}},{key:"_getSnapshot",value:function(e){var t=void 0,r=this.store.map(function(t){return t.getIn(e)}).subscribe(function(e){t=e});return r.unsubscribe(),t}},{key:"getStateSubject",value:function(e){var t=e.split("."),r=this._getSnapshot(t).get("$scopeId");if(!r)throw new Error("The state path you have required does not exist!");return new s.default(e,r,this)}},{key:"destroy",value:function(){this.store.complete()}}]),e}()})?n.apply(t,o):n)||(e.exports=i)},function(e,t,r){var n,o,i;o=[t],void 0===(i="function"==typeof(n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isPlainObject=function(e){return e&&(e.constructor===Object||void 0===e.constructor)},e.toCamelcase=function(e){return e.replace(/-([a-z])/gi,function(e,t){return t.toUpperCase()})}})?n.apply(t,o):n)||(e.exports=i)},function(e,t){e.exports=c},function(e,t,r){var n,o,i;o=[t,r(12),r(11),r(10)],void 0===(i="function"==typeof(n=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RxStore=void 0,e.connect=function(e,t,n){return function(o){return function(p){function f(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));return t.subject=null,t.state={},t.listeners=[],t.isConnected=!1,t.stateToPropsNames=[],"string"==typeof e&&t.createScope(),((0,r.isPlainObject)(e)||(0,r.isPlainObject)(n))&&(t.connectOptions=(0,r.isPlainObject)(e)?e:n,t.connectScope(t.connectOptions),t.isConnected=!0),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,p),c(f,[{key:"componentWillMount",value:function(){this.mapStateToProps(this.subject)}},{key:"createScope",value:function(){a.injectScope(e,t),this.subject=this.bindListener(a.getStateSubject(e)),this.isScopeHoster=!0}},{key:"connectScope",value:function(t){var r=this;this.subject?this.subject=u({},e,this.subject):this.subject={},Object.keys(t).filter(function(t){return t!==e}).forEach(function(e){var t=a.getStateSubject(e);r.subject[e]=r.bindListener(t)})}},{key:"componentWillUnmount",value:function(){this.listeners.forEach(function(e){e.unsubscribe()})}},{key:"bindListener",value:function(e){var t=this,r=e;return r.listen=function(r,n,o){var i=e.subscribe(r,n,o);return t.listeners.push(i),i},r}},{key:"mapStateToProps",value:function(e){var t=this;this.isConnected&&Object.keys(this.connectOptions).forEach(function(n){var o=t.connectOptions[n],i=e[n];"string"==typeof o?t.listenState(i,(0,r.toCamelcase)(o)):(0,r.isPlainObject)(o)?t.listenState(i,(0,r.toCamelcase)(o.propName),o.path):Array.isArray(o)&&o.forEach(function(e){"string"==typeof e?t.listenState(i,(0,r.toCamelcase)(e)):(0,r.isPlainObject)(e)&&t.listenState(i,(0,r.toCamelcase)(e.propName),e.path)})})}},{key:"listenState",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[t];this.stateToPropsNames.push(t),e.listen(function(e){r.setState(u({},t,e))},n)}},{key:"getProps",value:function(){var e=this,t={};return this.stateToPropsNames.forEach(function(r){t[r]=e.state[r]}),t}},{key:"render",value:function(){var e=this.getProps();return i.default.createElement(o,s({},this.props,e,{subject:this.subject}))}},{key:"debugID",get:function(){return this._reactInternalInstance._debugID}}]),f}(i.default.PureComponent)}};var o,i=(o=t)&&o.__esModule?o:{default:o},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e.RxStore=new n.RxStoreFactory})?n.apply(t,o):n)||(e.exports=i)}])});